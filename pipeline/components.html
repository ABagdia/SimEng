

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Common Components &mdash; SimEng  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> SimEng
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/building_simeng.html">Building SimEng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/running_simeng.html">Running SimEng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/configuring_simeng.html">Configuring SimEng</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/creating_binaries.html">Creating Binaries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/docker.html">Docker</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SimEng</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Common Components</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/UoB-HPC/SimEng/blob/master/pipeline/components.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="common-components">
<h1><a class="toc-backref" href="#id1">Common Components</a><a class="headerlink" href="#common-components" title="Permalink to this headline">¶</a></h1>
<p>The SimEng library contains numerous components for use within the default models, as well as for facilitating the creation of custom models.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#common-components" id="id1">Common Components</a></p>
<ul>
<li><p><a class="reference internal" href="#registerfileset" id="id2">RegisterFileSet</a></p></li>
<li><p><a class="reference internal" href="#registeraliastable" id="id3">RegisterAliasTable</a></p>
<ul>
<li><p><a class="reference internal" href="#allocation" id="id4">Allocation</a></p></li>
<li><p><a class="reference internal" href="#rewinding" id="id5">Rewinding</a></p></li>
<li><p><a class="reference internal" href="#committing" id="id6">Committing</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#architecturalregisterfileset" id="id7">ArchitecturalRegisterFileSet</a></p>
<ul>
<li><p><a class="reference internal" href="#mappedregisterfileset" id="id8">MappedRegisterFileSet</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#loadstorequeue" id="id9">LoadStoreQueue</a></p>
<ul>
<li><p><a class="reference internal" href="#loads" id="id10">Loads</a></p></li>
<li><p><a class="reference internal" href="#stores" id="id11">Stores</a></p></li>
<li><p><a class="reference internal" href="#ticking" id="id12">Ticking</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="registerfileset">
<h2><a class="toc-backref" href="#id2">RegisterFileSet</a><a class="headerlink" href="#registerfileset" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">RegisterFileSet</span></code> class models a set of register files, each containing any number of equally-sized registers. The default models each contain a single <code class="docutils literal notranslate"><span class="pre">RegisterFileSet</span></code> instance, with each register file within the set representing all registers of a discrete type (i.e., general purpose, floating point, etc.).</p>
<p>All data within the register files are stored as <code class="docutils literal notranslate"><span class="pre">RegisterValue</span></code> instances, and may be retrieved or modified using a <code class="docutils literal notranslate"><span class="pre">Register</span></code> identifier (see <a class="reference internal" href="../registers.html#registers"><span class="std std-ref">Registers</span></a> for more information).</p>
</div>
<div class="section" id="registeraliastable">
<h2><a class="toc-backref" href="#id3">RegisterAliasTable</a><a class="headerlink" href="#registeraliastable" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">RegisterAliasTable</span></code> class models the register alias table (RAT) found in most out-of-order processors to facilitate register renaming as a method of false dependency elimination. This component is responsible for handling the mappings between the conceptual “architectural registers” that the architecture defines, and the raw “physical registers” that the core contains.</p>
<p>Each architectural register is assigned a corresponding physical register, and recorded in an internal mapping table. The RAT can translate an architectural register to its corresponding physical register when queried.</p>
<div class="section" id="allocation">
<h3><a class="toc-backref" href="#id4">Allocation</a><a class="headerlink" href="#allocation" title="Permalink to this headline">¶</a></h3>
<p>At any time, a new physical register may be allocated to an architectural register. The RAT keeps an internal list of unallocated (“free”) physical registers, and will supply a new one and update its mapping table accordingly: future mapping queries on that architectural register will supply the newly allocated physical register instead.</p>
<p>The physical register previously allocated to the architectural register is internally recorded to facilitate rewinding (see below).</p>
</div>
<div class="section" id="rewinding">
<h3><a class="toc-backref" href="#id5">Rewinding</a><a class="headerlink" href="#rewinding" title="Permalink to this headline">¶</a></h3>
<p>It may sometimes be necessary to reverse the effects of an allocation - when an instruction is flushed, for example. The RAT provides a rewind system accordingly: the supplied physical register is freed, and the mapping table updated to reinstate the former physical register for the corresponding architectural register.</p>
</div>
<div class="section" id="committing">
<h3><a class="toc-backref" href="#id6">Committing</a><a class="headerlink" href="#committing" title="Permalink to this headline">¶</a></h3>
<p>At any point, a physical register may be “committed”. This locks the physical register to the architectural register it represents, freeing the previously-allocated physical register. This increases the number of registers available to be allocated, at the cost of preventing safe rewind beyond this point. Register commitment is typically performed at instruction commitment/retirement, when the instruction’s effects become irreversible and being able to rewind it is no longer necessary.</p>
</div>
</div>
<div class="section" id="architecturalregisterfileset">
<h2><a class="toc-backref" href="#id7">ArchitecturalRegisterFileSet</a><a class="headerlink" href="#architecturalregisterfileset" title="Permalink to this headline">¶</a></h2>
<p>To handle the conceptual distinction between physical and architectural registers, some components use an <code class="docutils literal notranslate"><span class="pre">ArchitecturalRegisterFileSet</span></code>, which guarantees that the registers accessed represent the architectural register identifier supplied. The base <code class="docutils literal notranslate"><span class="pre">ArchitecturalRegisterFileSet</span></code> class is a simple wrapper around a <code class="docutils literal notranslate"><span class="pre">RegisterFileSet</span></code>, with accesses performed with a 1:1 mapping.</p>
<div class="section" id="mappedregisterfileset">
<h3><a class="toc-backref" href="#id8">MappedRegisterFileSet</a><a class="headerlink" href="#mappedregisterfileset" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">MappedRegisterFileSet</span></code> is an <code class="docutils literal notranslate"><span class="pre">ArchitecturalRegisterFileSet</span></code> implementation which uses a <code class="docutils literal notranslate"><span class="pre">RegisterAliasTable</span></code> to map between the supplied architectural register and a physical register in the underlying <code class="docutils literal notranslate"><span class="pre">RegisterFileSet</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For mappings to be valid, the <code class="docutils literal notranslate"><span class="pre">RegisterAliasTable</span></code> must be in a “synchronised” state, with no uncommitted mappings, otherwise mappings will point to registers expected to hold the specified value in future. To satisfy this, <code class="docutils literal notranslate"><span class="pre">MappedRegisterFileSet</span></code> instances should only be used during exception handling, after the simulation has terminated, or other similar situations where no in-flight instructions remain.</p>
</div>
</div>
</div>
<div class="section" id="loadstorequeue">
<h2><a class="toc-backref" href="#id9">LoadStoreQueue</a><a class="headerlink" href="#loadstorequeue" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">LoadStoreQueue</span></code> class models the load/store queue (LSQ) common to many out-of-order architectures. This structure contains in-order references to all in-flight load and store instructions, which it uses to ensure memory operations occur in program order.</p>
<p>To accommodate multiple varieties of LSQ, this model provides two modes: <strong>split</strong>, representing an LSQ with two discrete independently sized queues for holding loads and stores respectively, and <strong>combined</strong>, representing an LSQ with a single shared queue that holds both loads and stores.</p>
<p>All load and store instructions should be added to the LSQ in program order; this typically happens during the last in-order stage of an out-of-order model. In the default SimEng pipeline units, <code class="docutils literal notranslate"><span class="pre">RenameUnit</span></code> performs this task.</p>
<div class="section" id="loads">
<h3><a class="toc-backref" href="#id10">Loads</a><a class="headerlink" href="#loads" title="Permalink to this headline">¶</a></h3>
<p>When initially added to the LSQ, loads are considered pending: they exist primarily to hold their place in the queue, and aren’t considered for memory order logic.</p>
<p>Once the addresses have been calculated for the load, the LSQ should be informed that the load operation can now be started. At this point, the LSQ will request the required data over the memory interface. Once these requests receive responses, during a later cycle, the data will be passed to the relevant load instructions and the load flagged as complete.</p>
<p>Once a completion slot is available, the load will be executed, the results broadcast to the supplied operand-forwarding handle, and the load instruction written into the completion slot. The load instruction will remain in the queue until it commits.</p>
</div>
<div class="section" id="stores">
<h3><a class="toc-backref" href="#id11">Stores</a><a class="headerlink" href="#stores" title="Permalink to this headline">¶</a></h3>
<p>As with loads, stores are considered pending when initially added to the LSQ.</p>
<p>When the store instruction is committed, a memory-order violation check takes place: all loads in the LSQ are searched in ascending age order to see if their addresses overlap with the store. If any are discovered, a flush is triggered to re-execute the invalid load instruction and everything after it. The data from the store is then submitted to the memory interface as one or more write requests, and the store is removed from the queue.</p>
</div>
<div class="section" id="ticking">
<h3><a class="toc-backref" href="#id12">Ticking</a><a class="headerlink" href="#ticking" title="Permalink to this headline">¶</a></h3>
<p>The LSQ is expected to be ticked once per clock cycle. This tick is used to handle responses to memory read requests, and finish execution of completed load instructions.</p>
<dl class="simple">
<dt>Handling responses</dt><dd><p>The memory interface is scanned for completed read requests. If any are present, the relevant load instruction is found and the data supplied, marking the load as complete.</p>
</dd>
<dt>Finishing execution</dt><dd><p>Depending on the number of completion slots available, completed load instructions are identified and executed to arrange the loaded data into the output register format, before writing the instructions into the completion slots.</p>
</dd>
</dl>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SimEng developers.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>